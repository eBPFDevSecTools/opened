<?xml version="1.0"?>
<doc>
<source file="/root/examples/bcc/tcpv4connect.c" funcheader="int kprobe__tcp_v4_connect (struct pt_regs *ctx, struct sock *sk)" startline="7" endline="15">
int kprobe__tcp_v4_connect (struct pt_regs *ctx, struct sock *sk)
{
    u32 pid = bpf_get_current_pid_tgid ();
    currsock.update (&pid, &sk);
    return 0;
}
</source>
<source file="/root/examples/bcc/tcpv4connect.c" funcheader="int kretprobe__tcp_v4_connect (struct pt_regs *ctx)" startline="17" endline="47">
int kretprobe__tcp_v4_connect (struct pt_regs *ctx)
{
    int ret = PT_REGS_RC (ctx);
    u32 pid = bpf_get_current_pid_tgid ();
    struct sock **skpp;
    skpp = currsock.lookup (&pid);
    if (skpp == 0) {
        return 0;
    }
    if (ret != 0) {
        currsock.delete (&pid);
        return 0;
    }
    struct sock *skp = *skpp;
    u32 saddr = skp->__sk_common.skc_rcv_saddr;
    u32 daddr = skp->__sk_common.skc_daddr;
    u16 dport = skp->__sk_common.skc_dport;
    bpf_trace_printk ("trace_tcp4connect %x %x %d\\n", saddr, daddr, ntohs (dport));
    currsock.delete (&pid);
    return 0;
}
</source>
</doc>
